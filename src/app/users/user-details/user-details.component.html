<div class="scrollable mx-auto h-full overflow-y-scroll bg-gray-50 p-6 dark:bg-gray-900">
    <!-- User Settings Section -->
    <div class="mb-8">
        <div class="mb-4 flex items-center gap-3">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100" i18n>User Settings</h3>
            @if (user) {
                <span
                    [ngClass]="{
                        'rounded-full px-3 py-1 text-xs font-semibold uppercase': true,
                        'bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400': user.role === Role.user,
                        'bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400': user.role === Role.admin,
                        'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400': user.role === Role.automation,
                        'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/50 dark:text-cyan-400': user.role === Role.developer,
                    }"
                    [textContent]="user.role"
                ></span>
            }
        </div>

        @if (user) {
            <div
                class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-800"
            >
                <div class="grid grid-cols-12 gap-5">
                    <!-- Name Field -->
                    <div
                        class="col-span-12"
                        [ngClass]="{ 'lg:col-span-5': !userId, 'lg:col-span-10': userId }"
                    >
                        <label
                            class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
                            i18n
                            for="user-name"
                            >Name</label
                        >
                        <input
                            type="text"
                            id="user-name"
                            [(ngModel)]="user.name"
                            [disabled]="!isEditing"
                            placeholder="Enter user name"
                            class="w-full rounded-lg border border-gray-300 bg-gray-50 p-3 text-sm text-gray-900 outline-none transition-colors focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:bg-gray-100 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:border-blue-400 dark:disabled:bg-gray-800"
                        />
                    </div>

                    <!-- Password Field (only for new users) -->
                    @if (isEditing && !userId) {
                        <div class="col-span-12 lg:col-span-5">
                            <label
                                class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
                                i18n
                                for="user-password"
                                >Password</label
                            >
                            <div class="relative">
                                <input
                                    [type]="showPassword ? 'text' : 'password'"
                                    id="user-password"
                                    [(ngModel)]="user.password"
                                    [disabled]="!isEditing"
                                    placeholder="Enter password"
                                    class="w-full rounded-lg border border-gray-300 bg-gray-50 p-3 pr-12 text-sm text-gray-900 outline-none transition-colors focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:bg-gray-100 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:border-blue-400 dark:disabled:bg-gray-800"
                                />
                                <button
                                    type="button"
                                    class="absolute right-2 top-1/2 -translate-y-1/2 rounded-md p-1.5 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-600 dark:hover:text-gray-200"
                                    (click)="togglePasswordVisibility()"
                                    aria-label="Toggle password visibility"
                                >
                                    <span class="material-icons-outlined text-xl">
                                        {{ showPassword ? "visibility_off" : "visibility" }}
                                    </span>
                                </button>
                            </div>
                        </div>
                    }

                    <!-- Role Select Field -->
                    <div class="col-span-12 lg:col-span-2">
                        <label
                            class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
                            i18n
                            for="user-role"
                            >Role</label
                        >
                        <select
                            id="user-role"
                            class="w-full rounded-lg border-2 bg-gray-50 p-3 text-sm font-semibold outline-none transition-colors focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:bg-gray-100 dark:bg-gray-700 dark:disabled:bg-gray-800"
                            [disabled]="!isEditing"
                            [(ngModel)]="user.role"
                            [ngClass]="{
                                'border-green-500 text-green-600 dark:border-green-400 dark:text-green-400': user.role === Role.user,
                                'border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400': user.role === Role.admin,
                                'border-yellow-500 text-yellow-600 dark:border-yellow-400 dark:text-yellow-400': user.role === Role.automation,
                                'border-cyan-500 text-cyan-600 dark:border-cyan-400 dark:text-cyan-400': user.role === Role.developer,
                            }"
                        >
                            <option [value]="Role.user">{{ Role.user }}</option>
                            <option [value]="Role.admin">{{ Role.admin }}</option>
                            <option [value]="Role.automation">{{ Role.automation }}</option>
                            <option [value]="Role.developer">{{ Role.developer }}</option>
                        </select>
                    </div>

                    <!-- Email Field with Copy Button -->
                    <div class="col-span-12">
                        <label
                            class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
                            for="user-email"
                            >Email</label
                        >
                        <div class="group relative">
                            <input
                                id="user-email"
                                [(ngModel)]="user.email"
                                [disabled]="!isEditing"
                                type="email"
                                placeholder="user@example.com"
                                class="w-full rounded-lg border border-gray-300 bg-gray-50 p-3 pr-12 font-mono text-sm text-gray-900 outline-none transition-colors focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:bg-gray-100 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:border-blue-400 dark:disabled:bg-gray-800"
                            />
                            <button
                                type="button"
                                class="absolute right-2 top-1/2 -translate-y-1/2 rounded-md p-1.5 text-gray-400 opacity-0 transition-all hover:bg-gray-100 hover:text-gray-600 group-hover:opacity-100 dark:hover:bg-gray-600 dark:hover:text-gray-200"
                                (click)="copyToClipboard(user.email)"
                                matTooltip="Copy email"
                            >
                                <mat-icon class="material-icons-outlined text-lg">content_copy</mat-icon>
                            </button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="col-span-12 flex gap-3 border-t border-gray-200 pt-5 dark:border-gray-700">
                        @if (!isEditing) {
                            <button
                                (click)="toggleEdit()"
                                class="flex-1 rounded-lg bg-blue-600 px-4 py-2.5 font-medium text-white transition-colors hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500/50 dark:bg-blue-500 dark:hover:bg-blue-600"
                                i18n
                            >
                                Edit
                            </button>
                        }
                        @if (!isEditing && userId) {
                            <button
                                (click)="delete()"
                                class="flex-1 rounded-lg border border-red-300 bg-white px-4 py-2.5 font-medium text-red-600 transition-colors hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500/50 dark:border-red-500/50 dark:bg-transparent dark:text-red-400 dark:hover:bg-red-900/20"
                                i18n
                            >
                                Delete
                            </button>
                        }
                        @if (isEditing) {
                            <button
                                (click)="cancelEdit()"
                                class="flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2.5 font-medium text-gray-700 transition-colors hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500/50 dark:border-gray-600 dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700"
                                i18n
                            >
                                Cancel
                            </button>
                            <button
                                (click)="saveChanges()"
                                class="flex-1 rounded-lg bg-blue-600 px-4 py-2.5 font-medium text-white transition-colors hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500/50 dark:bg-blue-500 dark:hover:bg-blue-600"
                                i18n
                            >
                                Save
                            </button>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<app-timeout-error-modal
    [message]="errorStr"
    [data]="errorData"
    #errorModal
></app-timeout-error-modal>
