map $http_accept_language $lang {
    default "en";
    ~^pt    "pt-BR";
    ~^es    "es-CL";
}

server {
    listen 80;
    server_name localhost;

    root /var/www/html;
    index index.html;

    # Redirect / to language detected from Accept-Language
    location = / {
        return 302 /$lang/;
    }

    # Serve static files for /en/
    location /en/ {
        try_files $uri $uri/ /en/index.html;
    }

    # Serve static files for /pt-BR/
    location /pt-BR/ {
        try_files $uri $uri/ /pt-BR/index.html;
    }

    # Serve static files for /es-CL/
    location /es-CL/ {
        try_files $uri $uri/ /es-CL/index.html;
    }

    # Redirect paths without locale prefix to detected language
    location / {
        return 302 /$lang$request_uri;
    }
}
